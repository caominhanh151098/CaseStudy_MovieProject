<html xmlns:th="http://www.thymeleaf.org" lang="en">
<div th:fragment="js">
    <script th:inline="javascript">
        let playVideo = document.getElementById("player");
        let genreMovie = document.getElementById("genre");
        let episode = document.getElementById("episode");
        let url = location.href;
        let id = url.slice(31);
        let movieId = id.split('-')[0];
        let idEp = id.split('-')[1];
        let movie;
        let videoPlayer = document.querySelector("video");
        initData();
        if (movieId == "")
            location.href = "/";

        function initData() {
            $.ajax({
                url: `http://localhost:8080/api/movie/watch/${movieId}`,
                method: "GET"
            }).done(data => {
                movie = data;
                genreMovie.innerHTML = `
                 <div class="breadcrumb__links">
                    <a href="/"><i class="fa fa-home"></i> Home</a>
                    <a href="./categories.html">Thể loại</a>
                    <a href="#${movie.genre.id}">${movie.genre.name || ""}</a>
                    <a href="/phim/${movie.id}">${movie.name}</a>
                    <span id="nameEp"></span>
                </div>`
                let episodeMovie = "";
                movie.seriesMovie.forEach(f => {
                    episodeMovie += `<a href="${movieId + "-" + f.id}">${f.name}</a>`;
                })
                episode.innerHTML = episodeMovie;
                if (!checkIdMovie(idEp))
                    location.href = "/";

                $.ajax({
                    url: `http://localhost:8080/api/movie/watch_url/${idEp}`,
                    method: "GET"
                }).done(data => {
                    let film = data;
                    // videoPlayer.innerHTML = `<source src="../assets/client/videos/Transformers7.mp4">`
                    playVideo.innerHTML = `
                    <iframe id="iframePlayer" src="${film.url}" id="videoPlayer" width="847" height="476.4375" frameborder="0" allowfullscreen="">
                    </iframe>`
                    document.getElementById("nameEp").innerHTML = `${film.name}`
                })
            })
            setTimeout(() => {
                addEvent()
            }, 1000)
        }

        function addEvent() {
        }

        function checkIdMovie(id) {
            let check = false
            movie.seriesMovie.forEach(f => {
                if (f.id == id)
                    return check = true;
            })
            return check;
        }
        function startPlaying() {
            console.log("play");
        }
        function pausePlaying() {
            console.log("stop");
        }
    </script>
</div>